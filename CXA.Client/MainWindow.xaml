<Window x:Class="CXA.Client.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="CXA - Biometric Authentication" Height="720" Width="480"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        WindowStartupLocation="CenterScreen" ResizeMode="NoResize"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- Pulsing Animation -->
            <Storyboard x:Key="PulseAnimation" RepeatBehavior="Forever">
                <DoubleAnimation Storyboard.TargetName="FaceGuideGlow" 
                                 Storyboard.TargetProperty="Opacity"
                                 From="0.2" To="0.6" Duration="0:0:2" AutoReverse="True">
                    <DoubleAnimation.EasingFunction>
                        <SineEase EasingMode="EaseInOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>

            <!-- Scanning Animation -->
            <Storyboard x:Key="ScanAnimation" RepeatBehavior="Forever">
                <DoubleAnimation Storyboard.TargetName="ScanLine" 
                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                                 From="-120" To="120" Duration="0:0:3">
                    <DoubleAnimation.EasingFunction>
                        <SineEase EasingMode="EaseInOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="ScanLine" 
                                 Storyboard.TargetProperty="Opacity"
                                 From="0.8" To="0.2" Duration="0:0:3" AutoReverse="True"/>
            </Storyboard>
        </ResourceDictionary>
    </Window.Resources>

    <Window.Triggers>
        <EventTrigger RoutedEvent="Window.Loaded">
            <BeginStoryboard Storyboard="{StaticResource PulseAnimation}"/>
            <BeginStoryboard Storyboard="{StaticResource ScanAnimation}"/>
        </EventTrigger>
    </Window.Triggers>

    <!-- Main Container with Rounded Corners -->
    <Border CornerRadius="24" ClipToBounds="True">
        <Border.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#0D1117" Offset="0"/>
                <GradientStop Color="#161B22" Offset="1"/>
            </LinearGradientBrush>
        </Border.Background>
        <Border.Effect>
            <DropShadowEffect BlurRadius="40" ShadowDepth="10" Opacity="0.6" Color="#000000"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 TITLE BAR
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Grid Grid.Row="0" Margin="24,20,24,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Width="32" Height="32" CornerRadius="10" Margin="0,0,12,0" Background="#21262D">
                        <Path Data="M12,2 L22,6 L22,12 C22,17 17,21 12,22 C7,21 2,17 2,12 L2,6 L12,2 Z"
                              Fill="#58A6FF" Stretch="Uniform" Width="18" Height="18"
                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="CXA" FontSize="16" FontWeight="SemiBold" 
                                   Foreground="#F0F6FC" FontFamily="Segoe UI Variable"/>
                        <TextBlock Text="Biometric Access" FontSize="11" FontWeight="Light" 
                                   Foreground="#8B949E" Margin="0,-2,0,0"/>
                    </StackPanel>
                </StackPanel>

                <!-- Window Controls -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Style="{StaticResource IconButton}" Click="MinimizeButton_Click" ToolTip="Minimize">
                        <Path Data="M19,13H5V11H19V13Z" Fill="#8B949E" Width="10" Height="10" Stretch="Uniform"/>
                    </Button>
                    <Button Style="{StaticResource IconButton}" Click="CloseButton_Click" ToolTip="Close" Margin="8,0,0,0">
                        <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" 
                              Fill="#8B949E" Width="10" Height="10" Stretch="Uniform"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 MAIN CONTENT - CIRCULAR CAMERA FEED
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Grid Grid.Row="1" Margin="32,24,32,24">
                
                <!-- Circular Camera Mask -->
                <Grid Width="320" Height="320" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Grid.OpacityMask>
                        <VisualBrush>
                            <VisualBrush.Visual>
                                <Ellipse Width="320" Height="320" Fill="Black"/>
                            </VisualBrush.Visual>
                        </VisualBrush>
                    </Grid.OpacityMask>

                    <!-- Background when no camera -->
                    <Border Background="#1C2128"/>

                    <!-- Camera Feed -->
                    <Image Name="CameraFeed" Stretch="UniformToFill" Source="{Binding CameraFeed}"
                           RenderOptions.BitmapScalingMode="HighQuality"
                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    
                    <!-- Scan Line Overlay -->
                    <Rectangle x:Name="ScanLine" Width="320" Height="4" VerticalAlignment="Center"
                               Visibility="{Binding ScanningLineVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Rectangle.Fill>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="#0058A6FF" Offset="0"/>
                                <GradientStop Color="#58A6FF" Offset="0.5"/>
                                <GradientStop Color="#0058A6FF" Offset="1"/>
                            </LinearGradientBrush>
                        </Rectangle.Fill>
                        <Rectangle.RenderTransform>
                            <TranslateTransform Y="0"/>
                        </Rectangle.RenderTransform>
                    </Rectangle>
                </Grid>

                <!-- Outer Glow Ring -->
                <Ellipse x:Name="FaceGuideGlow" Width="340" Height="340" 
                         HorizontalAlignment="Center" VerticalAlignment="Center"
                         StrokeThickness="0">
                    <Ellipse.Fill>
                        <RadialGradientBrush>
                            <GradientStop Color="#2058A6FF" Offset="0.8"/>
                            <GradientStop Color="Transparent" Offset="1"/>
                        </RadialGradientBrush>
                    </Ellipse.Fill>
                </Ellipse>

                <!-- Static Border Ring -->
                <Ellipse Width="320" Height="320" HorizontalAlignment="Center" VerticalAlignment="Center"
                         Stroke="#30363D" StrokeThickness="2"/>

                <!-- Success Checkmark Overlay -->
                <Grid x:Name="SuccessCheckmark" Visibility="{Binding ShowSuccessCheckmark, Converter={StaticResource BooleanToVisibilityConverter}}"
                      HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Ellipse Width="100" Height="100" Fill="#238636" Opacity="0.9"/>
                    <Path Data="M35,50 L48,65 L70,35" Stroke="White" StrokeThickness="6"
                          StrokeStartLineCap="Round" StrokeEndLineCap="Round" StrokeLineJoin="Round"/>
                </Grid>

            </Grid>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 BOTTOM STATUS PANEL
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <StackPanel Grid.Row="2" Margin="24,0,24,30">
                
                <!-- Status Text -->
                <StackPanel HorizontalAlignment="Center" Margin="0,0,0,24">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                        <Ellipse x:Name="StatusDot" Width="8" Height="8" Margin="0,0,8,0">
                            <Ellipse.Fill>
                                <SolidColorBrush Color="#58A6FF"/>
                            </Ellipse.Fill>
                        </Ellipse>
                        <TextBlock x:Name="StatusTitle" Text="{Binding StatusMessage}" FontSize="16" FontWeight="SemiBold" 
                                   Foreground="#F0F6FC" TextAlignment="Center"/>
                    </StackPanel>
                    
                    <TextBlock x:Name="StatusDescription" Text="{Binding StatusText}" FontSize="13" Foreground="#8B949E" 
                               TextAlignment="Center" TextWrapping="Wrap"/>
                </StackPanel>

                <!-- Action Buttons -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0" Content="ðŸ“Š Dashboard" Click="Dashboard_Click"
                            Style="{StaticResource ModernButton}" Height="40"/>
                            
                    <Button Grid.Column="2" Content="ðŸ”‘ Use PIN" Click="FallbackAuth_Click"
                            Style="{StaticResource ModernButton}" Height="40"/>
                </Grid>
                
                <!-- Version Info -->
                <TextBlock Text="{Binding AppVersion, StringFormat='v{0}'}" 
                           FontSize="10" Foreground="#8B949E" Opacity="0.5"
                           HorizontalAlignment="Center" Margin="0,12,0,0" />
            </StackPanel>

        </Grid>
    </Border>
</Window>
